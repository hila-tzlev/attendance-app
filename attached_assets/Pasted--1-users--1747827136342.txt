### תכנון בסיס נתונים לפרויקט ניהול נוכחות

#### טבלאות מוצעות:

1. **users - טבלת משתמשים**

   * `id` (Primary Key): מזהה ייחודי אוטומטי לכל משתמש במערכת.
   * `employee_id`: מספר תעודת זהות של העובד.
   * `name`: שם העובד.
   * `password`: סיסמת המשתמש (תישמר בצורה מוצפנת).
   * `is_manager`: משתנה בוליאני (true/false) לציון האם המשתמש הוא מנהל.
   * `department_id` (Foreign Key): מזהה המחלקה אליה שייך המשתמש.
   * `created_at`: תאריך יצירת הרשומה.

   **שימושים:**

   * אחסון פרטי העובדים.
   * שיוך עובדים למחלקות לצורך ניהול היררכי.
   * זיהוי האם מדובר בעובד רגיל או מנהל (לצרכי אישור דיווחים).
   * ניהול הרשאות כניסה מאובטחות לאפליקציה.

2. **departments - טבלת מחלקות**

   * `id` (Primary Key): מזהה ייחודי של המחלקה.
   * `name`: שם המחלקה.

   **שימושים:**

   * ארגון העובדים לפי מחלקות.
   * מתן הרשאות למנהלים לפי מחלקה.

3. **attendance\_logs - טבלת דיווחי נוכחות**

   * `id` (Primary Key): מזהה ייחודי לדיווח.
   * `user_id` (Foreign Key): מזהה המשתמש שדיווח.
   * `clock_in`: זמן כניסה.
   * `clock_out`: זמן יציאה.
   * `status`: סטטוס הדיווח - יכול להיות "PENDING", "APPROVED" או "REJECTED".
   * `is_manual_entry`: משתנה בוליאני - האם הדיווח הוזן ידנית.
   * `manual_reason`: סיבת הדיווח הידני (רלוונטי רק אם is\_manual\_entry=true).
   * `latitude`: קואורדינטת רוחב (GPS).
   * `longitude`: קואורדינטת אורך (GPS).
   * `created_at`: מועד יצירת הדיווח.
   * `updated_at`: מועד עדכון אחרון.
   * `updated_by`: מזהה המשתמש האחרון שביצע שינוי ברשומה (Foreign Key ל-users).

   **שימושים:**

   * תיעוד דיווחי כניסה ויציאה של עובדים.
   * תמיכה בדיווחים רגילים ואישורים ע"י מנהלים.
   * מעקב אחר שינויים וזיהוי מי ביצע כל עדכון.
   * אפשרות הצגת דיווחים ידניים למנהלים לפי שדה `is_manual_entry`.
   * שמירה על מיקום הדיווח באמצעות GPS.

   **הערה לגבי `updated_at`:** שדה זה מתעדכן אוטומטית בכל שינוי בשורה – לדוגמה בעת שינוי סטטוס הדיווח או עדכון זמני הנוכחות. הוא מסייע למעקב אחר הפעולה האחרונה שבוצעה.

4. **manual\_updates - טבלת עדכונים ידניים** *(ייתכן וניתן לבטל טבלה זו בהמשך ולהתמקד רק ב-attendance\_logs)*

   * **הערה:** ייתכן שאין צורך בטבלה נפרדת, שכן כל הבקשות לעדכונים ידניים נשמרות כבר בטבלת `attendance_logs` יחד עם סיבת הבקשה, סוג הדיווח, והיסטוריית עדכון. שמירה על טבלה אחת מונעת כפילות מיותרת, מפשטת את הקוד ותומכת במבנה יעיל יותר.

---

### תהליך היישום המוצע:

1. **הקמת בסיס נתונים (Database)** ב-Replit

   * שימוש ב-SQLite או PostgreSQL (בהתאם למה שרפליט תומך בו בפרויקט).

2. **יצירת הטבלאות**

   * הגדרת סכמות לפי התכנון למעלה.
   * ניתן להיעזר ב-Prisma Migrate כדי ליצור את הסכמות בפועל.

3. **שילוב Prisma ORM**

   * ניהול הגישה לדאטה דרך Prisma, כולל יצירה, קריאה, עדכון ומחיקה.
   * שמירה על טיפוסיות חזקה ונוחות עבודה בקוד.

4. **עדכון קומפוננטות האפליקציה**

   * מעבר משימוש ב-localStorage לעבודה ישירה מול ה-Database.
   * עדכון הלוגיקה בהתאם (בדיקת כניסה, שליחה/אישור דיווחים, הצגת נתונים).

---

### שאלות פתוחות:

* האם צריך לנהל היסטוריית עדכונים גם לאחר אישור?

נשמח לאישור או הערות נוספות לפני שמתחילים בביצוע בפועל.
